<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Fazer Pedidos no Restaurante / Caf√© ‚Äì Scott</title>

<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --blue:#0b69ff;
    --blue-soft:#58a6ff;
    --green:#17a34a;
    --teal:#04695c;
    --gray:#555;
    --border:#e0e0e0;
    --bg:#fafafa;
    --card:#fff;
  }
  body{
    font-family:'Open Sans',sans-serif;
    background:var(--bg);color:#111;
    padding:20px;max-width:900px;margin:auto;
    line-height:1.6;
  }
  h1{
    font-size:26px;text-align:center;
    color:var(--blue);margin-bottom:10px;
  }
  h2{
    font-size:20px;margin-top:30px;
    padding-bottom:8px;border-bottom:2px solid var(--border);
    display:flex;align-items:center;justify-content:space-between;
    flex-wrap:wrap;
  }
  h3{
    font-size:18px;margin-top:20px;margin-bottom:6px;
  }
  .section-controls{display:flex;gap:10px;flex-wrap:wrap}

  button{
    padding:8px 14px;border:none;border-radius:6px;
    cursor:pointer;font-size:14px;font-weight:600;
    transition:background .3s;
  }
  button.play{background:var(--blue);color:#fff}
  button.slow{background:var(--blue-soft);color:#fff}
  button.repeat{background:var(--green);color:#fff}
  button.download{background:var(--gray);color:#fff}
  button.download.done{background:var(--green)}
  button.quiz{background:var(--teal);color:#fff}

  table{
    width:100%;border-collapse:collapse;margin-top:10px;
    background:var(--card);border-radius:6px;overflow:hidden;
  }
  th,td{
    padding:10px;text-align:left;border-bottom:1px solid #eee;
  }
  td.pt{font-weight:600;width:45%}
  td.en{width:45%;color:#555}
  td.actions{width:10%;text-align:center}

  .progress-message{font-size:14px;color:var(--blue);margin-top:6px}

  .quiz-box{
    margin-top:15px;padding:15px;
    border:1px solid #ddd;border-radius:8px;
    background:var(--card);
  }
  .quiz-question{font-weight:600;margin-bottom:10px}
  .quiz-options{display:flex;flex-direction:column;gap:8px}
  .quiz-options button{background:var(--blue);color:#fff}
  .quiz-options button.correct{background:var(--green)!important}
  .quiz-options button.wrong{background:#e53935!important}

  .quiz-bar{
    display:flex;gap:10px;flex-wrap:wrap;
    justify-content:center;margin:18px 0 10px;
  }
  .mode-chooser{
    display:flex;gap:10px;flex-wrap:wrap;
    justify-content:center;margin-top:8px;
  }

  .muted{color:#666;font-size:13px}
  .audio-buttons{display:flex;gap:10px;margin-bottom:10px}

  /* Flashcards */
  .flashcard-section{
    margin-top:30px;
  }
  .flashcard-controls{
    display:flex;gap:10px;flex-wrap:wrap;
    justify-content:center;margin:10px 0 15px;
  }
  .flashcard{
    background:var(--card);
    border-radius:10px;
    box-shadow:0 2px 6px rgba(0,0,0,0.08);
    padding:16px;
    text-align:center;
    max-width:420px;
    margin:0 auto 10px auto;
    cursor:pointer;
    transition:transform .15s ease, box-shadow .15s ease;
  }
  .flashcard:hover{
    transform:translateY(-2px);
    box-shadow:0 4px 10px rgba(0,0,0,0.12);
  }
  .flashcard img{
    max-width:100%;
    max-height:220px;
    object-fit:contain;
    display:block;
    margin:0 auto 10px;
  }
  .flashcard-pt{
    font-size:18px;
    font-weight:600;
    margin-bottom:6px;
  }
  .flashcard-en{
    font-size:16px;
    color:#444;
  }
  .flashcard-index{
    font-size:13px;
    color:#777;
    margin-top:6px;
  }
  .flashcard-audio{
    margin-top:8px;
    display:flex;
    justify-content:center;
    gap:8px;
  }

  /* Roleplay / Dialogues */
  .dialogue{
    background:var(--card);
    border-radius:10px;
    padding:12px 14px;
    border-left:4px solid var(--blue);
    margin-bottom:14px;
  }
  .dialogue p{
    margin:4px 0;
  }
  .dialogue span.speaker{
    font-weight:600;
    color:var(--teal);
  }

  @media (max-width:640px){
    td.actions{text-align:left}
  }
</style>
</head>

<body>
<h1>Fazer Pedidos no Restaurante / Caf√© ‚Äì Scott</h1>

<p style="text-align:center;color:#444;max-width:700px;margin:auto;">
  Pratique frases de Portugu√™s Europeu para caf√©s e restaurantes. Ou√ßa, repita, fa√ßa download do √°udio,
  use os cart√µes de mem√≥ria com imagens e teste-se com o quiz global de texto ou de √°udio.
</p>

<!-- QUIZ CONTROLS -->
<div class="quiz-bar">
  <button class="quiz" id="startQuizUnified">üéì Iniciar Quiz Global</button>
</div>

<div id="quizUnifiedStep" class="muted" style="text-align:center;"></div>
<div id="globalQuizBox" class="quiz-box" style="display:none;"></div>

<div id="phrasebook"></div>

<!-- FLASHCARDS SECTION -->
<div class="flashcard-section">
  <h2>
    <span>Cart√µes de Mem√≥ria (Flashcards)</span>
  </h2>
  <p class="muted" style="text-align:center;">
    Clique em ‚ÄúCome√ßar‚Äù para ver cart√µes com imagem. Toque no cart√£o para alternar entre Portugu√™s e Ingl√™s.
  </p>
  <div class="flashcard-controls">
    <button class="quiz" id="startFlashcards">‚ñ∂Ô∏è Come√ßar</button>
    <button class="quiz" id="prevFlashcard">‚¨ÖÔ∏è Anterior</button>
    <button class="quiz" id="nextFlashcard">‚û°Ô∏è Seguinte</button>
    <button class="quiz" id="shuffleFlashcards">üîÄ Baralhar</button>
  </div>
  <div id="flashcardBox" class="flashcard" style="display:none;"></div>
</div>

<!-- ROLEPLAY SECTION -->
<h2>
  <span>Roleplay (Simula√ß√µes de Conversa)</span>
</h2>

<p class="muted">
  Use estes di√°logos para praticar com o seu aluno. O <strong>Cliente</strong> e o <strong>Empregado</strong>
  est√£o claramente identificados. Comece pelos n√≠veis mais f√°ceis e v√° aumentando a dificuldade.
</p>

<h3>N√≠vel 1 ‚Äì B√°sico</h3>
<div class="dialogue">
  <p><span class="speaker">Cliente:</span> Boa tarde. T√™m mesa para duas pessoas?</p>
  <p><span class="speaker">Empregado:</span> Boa tarde. Sim, temos. Por aqui, se faz favor.</p>
  <p><span class="speaker">Cliente:</span> Obrigado. Podemos ver o menu, por favor?</p>
  <p><span class="speaker">Empregado:</span> Claro, aqui est√°.</p>
  <p><span class="speaker">Cliente:</span> Para mim, o bife com batatas fritas.</p>
  <p><span class="speaker">Empregado:</span> Muito bem. E para beber?</p>
  <p><span class="speaker">Cliente:</span> Uma √°gua, por favor.</p>
  <p><span class="speaker">Empregado:</span> Est√° bem. J√° trago.</p>
</div>

<h3>N√≠vel 2 ‚Äì Interm√©dio</h3>
<div class="dialogue">
  <p><span class="speaker">Cliente:</span> Ol√°, eu tenho uma reserva em nome de Scott.</p>
  <p><span class="speaker">Empregado:</span> Boa noite, senhor Scott. Querem sentar-se l√° fora ou c√° dentro?</p>
  <p><span class="speaker">Cliente:</span> C√° dentro, se faz favor.</p>
  <p><span class="speaker">Empregado:</span> Muito bem, por aqui. Aqui est√° o menu.</p>
  <p><span class="speaker">Empregado:</span> J√° sabem o que v√£o pedir ou precisam de mais um momento?</p>
  <p><span class="speaker">Cliente:</span> Ainda n√£o estamos prontos. Mais um minuto, por favor.</p>
  <p><span class="speaker">Empregado:</span> Claro.</p>
  <p><span class="speaker">Cliente:</span> Agora estamos prontos. Para mim, o prato do dia.</p>
  <p><span class="speaker">Empregado:</span> E para beber?</p>
  <p><span class="speaker">Cliente:</span> Uma Superbock fresca, por favor.</p>
</div>

<h3>N√≠vel 3 ‚Äì Interm√©dio-Alto</h3>
<div class="dialogue">
  <p><span class="speaker">Cliente:</span> Boa noite. T√™m mesa para quatro pessoas?</p>
  <p><span class="speaker">Empregado:</span> Boa noite. Sim, temos. Podem seguir-me, por favor.</p>
  <p><span class="speaker">Cliente:</span> Obrigado. Posso ver o menu?</p>
  <p><span class="speaker">Empregado:</span> Claro. Hoje temos alguns pratos do dia muito bons.</p>
  <p><span class="speaker">Cliente:</span> Quais s√£o os pratos do dia?</p>
  <p><span class="speaker">Empregado:</span> Temos bacalhau √† Br√°s, porco √† Alentejana e polvo grelhado.</p>
  <p><span class="speaker">Cliente:</span> O polvo √© picante?</p>
  <p><span class="speaker">Empregado:</span> N√£o, n√£o √© picante. Mas se quiser, podemos p√¥r molho picante √† parte.</p>
  <p><span class="speaker">Cliente:</span> Perfeito. Para mim, o polvo grelhado com salada, por favor.</p>
  <p><span class="speaker">Empregado:</span> Muito bem. E para beber?</p>
  <p><span class="speaker">Cliente:</span> Uma garrafa de √°gua sem g√°s e um copo de vinho branco.</p>
  <p><span class="speaker">Empregado:</span> Est√° bem, j√° trago.</p>
</div>

<h3>N√≠vel 4 ‚Äì Avan√ßado</h3>
<div class="dialogue">
  <p><span class="speaker">Cliente:</span> Boa tarde. Somos tr√™s e temos uma reserva para as oito.</p>
  <p><span class="speaker">Empregado:</span> Boa tarde. Em nome de quem, se faz favor?</p>
  <p><span class="speaker">Cliente:</span> Em nome de Scott.</p>
  <p><span class="speaker">Empregado:</span> Sim, est√° aqui. Querem sentar-se junto √† janela ou mais no fundo?</p>
  <p><span class="speaker">Cliente:</span> Junto √† janela, por favor.</p>
  <p><span class="speaker">Empregado:</span> Muito bem. Aqui est√° o menu. Se tiverem alguma d√∫vida, digam-me.</p>
  <p><span class="speaker">Cliente:</span> Eu estou a aprender portugu√™s, queria praticar o meu portugu√™s. Pode falar um bocadinho mais devagar?</p>
  <p><span class="speaker">Empregado:</span> Claro, sem problema. T√™m alguma alergia?</p>
  <p><span class="speaker">Cliente:</span> Sim, sou al√©rgico a marisco. O prato do dia tem marisco?</p>
  <p><span class="speaker">Empregado:</span> Hoje o prato do dia √© frango com arroz, sem marisco.</p>
  <p><span class="speaker">Cliente:</span> √ìtimo. Ent√£o para mim, o prato do dia. Pode vir sem salada e com mais vegetais?</p>
  <p><span class="speaker">Empregado:</span> Sim, podemos trocar a salada por vegetais.</p>
  <p><span class="speaker">Cliente:</span> Perfeito, obrigado.</p>
</div>

<h3>N√≠vel 5 ‚Äì Desafio</h3>
<div class="dialogue">
  <p><span class="speaker">Empregado:</span> Boa noite, bem-vindos. T√™m reserva ou √© s√≥ chegar?</p>
  <p><span class="speaker">Cliente:</span> Boa noite. N√£o temos reserva. T√™m mesa para duas pessoas?</p>
  <p><span class="speaker">Empregado:</span> Temos, sim. Vai demorar s√≥ cinco minutos. Querem esperar na esplanada?</p>
  <p><span class="speaker">Cliente:</span> Sim, perfeito.</p>
  <p><span class="speaker">Empregado:</span> Pronto, a mesa j√° est√°. Podem acompanhar-me, por favor.</p>
  <p><span class="speaker">Cliente:</span> Obrigado.</p>
  <p><span class="speaker">Empregado:</span> Aqui est√° o menu. Hoje temos v√°rios especiais. Se quiserem, posso recomendar alguma coisa.</p>
  <p><span class="speaker">Cliente:</span> √ìtimo, o que recomenda?</p>
  <p><span class="speaker">Empregado:</span> O camar√£o Mo√ßambique √© muito popular, e o bitoque tamb√©m.</p>
  <p><span class="speaker">Cliente:</span> Ent√£o, para mim, o camar√£o Mo√ßambique e, para ela, o bitoque.</p>
  <p><span class="speaker">Empregado:</span> Muito bem. E para beber?</p>
  <p><span class="speaker">Cliente:</span> Uma jarra de vinho tinto e uma √°gua com lim√£o, por favor.</p>
  <p><span class="speaker">Empregado:</span> Perfeito. No final, querem o recibo?</p>
  <p><span class="speaker">Cliente:</span> Sim, por favor.</p>
</div>

<!-- ZIP helpers -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
// ----------------------------------------------------
// SECTIONS: RESTAURANT / CAF√â PHRASES
// ----------------------------------------------------
const sections = [
  {
    title:'Verbos e Estruturas para Fazer Pedidos (Verbs & Structures for Ordering)',
    phrases:[
      {id:'c1', pt:'Queria‚Ä¶', en:'I would like‚Ä¶'},
      {id:'c2', pt:'Gostaria de‚Ä¶', en:'I would like‚Ä¶'},
      {id:'c3', pt:'Gostava de‚Ä¶', en:'I would like‚Ä¶'},
      {id:'c4', pt:'Podia‚Ä¶?', en:'Could I‚Ä¶?'},
      {id:'c5', pt:'Poderia‚Ä¶?', en:'Could I‚Ä¶?'},
      {id:'c6', pt:'Podia dar-me‚Ä¶?', en:'Could you give me‚Ä¶?'},
      {id:'c7', pt:'Podia trazer-me‚Ä¶?', en:'Could you bring me‚Ä¶?'},
      {id:'c8', pt:'Podia ter‚Ä¶?', en:'Could I have‚Ä¶?'},
      {id:'c9', pt:'Para mim, era‚Ä¶', en:"For me, I'll have‚Ä¶"},
      {id:'c10', pt:'Para j√° quero‚Ä¶', en:'For now, I want‚Ä¶'},
      {id:'c11', pt:'Eu queria pedir‚Ä¶', en:'I would like to order‚Ä¶'}
    ]
  },
  {
    title:'Express√µes de Cortesia (Polite Expressions)',
    phrases:[
      {id:'c12', pt:'Com licen√ßa', en:'Excuse me'},
      {id:'c13', pt:'Desculpe', en:'Sorry / excuse me'},
      {id:'c14', pt:'Por favor', en:'Please'},
      {id:'c15', pt:'Se faz favor', en:'Please (formal)'},
      {id:'c16', pt:'Obrigado', en:'Thank you (said by a man)'},
      {id:'c17', pt:'Obrigada', en:'Thank you (said by a woman)'},
      {id:'c18', pt:'De nada', en:"You're welcome"}
    ]
  },
  {
    title:'Reservas e Pedidos de Mesa (Reservations & Asking for a Table)',
    phrases:[
      {id:'c19', pt:'Gostaria de uma mesa para tr√™s pessoas.', en:'I would like a table for three.'},
      {id:'c20', pt:'T√™m mesa para duas pessoas?', en:'Do you have a table for two?'},
      {id:'c21', pt:'Queria uma mesa l√° fora.', en:'I wanted a table outside.'},
      {id:'c22', pt:'Queria uma mesa c√° dentro.', en:'I wanted a table inside.'},
      {id:'c23', pt:'Eu tenho uma reserva.', en:'I have a reservation.'},
      {id:'c24', pt:'Tenho uma reserva em nome de‚Ä¶', en:'I have a reservation under the name‚Ä¶'},
      {id:'c25', pt:'Querem sentar-se l√° fora ou c√° dentro?', en:'Would you like to sit outside or inside?'},
      {id:'c26', pt:'A esplanada est√° aberta.', en:'The terrace is open.'},
      {id:'c27', pt:'Vai demorar muito?', en:'Will it take long?'}
    ]
  },
  {
    title:'Frases ao Chegar e Interagir com o Empregado (Arriving & Talking to the Waiter)',
    phrases:[
      {id:'c28', pt:'Boa tarde, t√™m mesa?', en:'Good afternoon, do you have a table?'},
      {id:'c29', pt:'Somos dois.', en:'We are two.'},
      {id:'c30', pt:'Somos tr√™s.', en:'We are three.'},
      {id:'c31', pt:'Somos quatro.', en:'We are four.'},
      {id:'c32', pt:'Posso ver o menu?', en:'Can I see the menu?'},
      {id:'c33', pt:'J√° sabem o que v√£o pedir?', en:"Do you know what you're going to order?"},
      {id:'c34', pt:'Um momento, por favor.', en:'One moment, please.'},
      {id:'c35', pt:'Estamos prontos.', en:'We are ready.'},
      {id:'c36', pt:'Ainda n√£o estamos prontos.', en:"We're not ready yet."}
    ]
  },
  {
    title:'Frases para Pedir Comida (Ordering Food)',
    phrases:[
      {id:'c37', pt:'Podia ter salm√£o com arroz?', en:'Could I have salmon with rice?'},
      {id:'c38', pt:'Eu queria o prato do dia.', en:'I would like the dish of the day.'},
      {id:'c39', pt:'Para mim, o bife com batatas fritas.', en:'For me, the steak with fries.'},
      {id:'c40', pt:'O que recomenda?', en:'What do you recommend?'},
      {id:'c41', pt:'Quais s√£o os pratos do dia?', en:'What are the dishes of the day?'},
      {id:'c42', pt:'Quais s√£o os especiais?', en:'What are the specials?'},
      {id:'c43', pt:'Eu queria o menu de sobremesas, por favor.', en:'I would like the dessert menu, please.'},
      {id:'c44', pt:'Pode vir sem‚Ä¶?', en:'Can it come without‚Ä¶?'},
      {id:'c45', pt:'√â picante?', en:'Is it spicy?'},
      {id:'c46', pt:'Tem op√ß√µes vegetarianas?', en:'Do you have vegetarian options?'}
    ]
  },
  {
    title:'Frases para Pedir Bebidas (Ordering Drinks)',
    phrases:[
      {id:'c47', pt:'Para beber, queria‚Ä¶', en:'To drink, I would like‚Ä¶'},
      {id:'c48', pt:'Um copo de‚Ä¶', en:'A glass of‚Ä¶'},
      {id:'c49', pt:'Uma garrafa de √°gua.', en:'A bottle of water.'},
      {id:'c50', pt:'√Ågua com g√°s ou sem g√°s?', en:'Sparkling or still water?'},
      {id:'c51', pt:'Um caf√© / uma bica.', en:'An espresso.'},
      {id:'c52', pt:'Um ch√° de lim√£o.', en:'A lemon tea.'},
      {id:'c53', pt:'Uma cerveja, por favor.', en:'A beer, please.'},
      {id:'c54', pt:'Uma Superbock / uma Sagres.', en:'A Superbock / a Sagres.'},
      {id:'c55', pt:'Um sumo de‚Ä¶', en:'A juice of‚Ä¶'},
      {id:'c56', pt:'T√™m refrigerantes?', en:'Do you have soft drinks?'}
    ]
  },
  {
    title:'Vocabul√°rio de Comida (Food Vocabulary)',
    phrases:[
      {id:'c57', pt:'Salm√£o', en:'Salmon'},
      {id:'c58', pt:'Arroz', en:'Rice'},
      {id:'c59', pt:'Bife com batatas fritas', en:'Steak with fries'},
      {id:'c60', pt:'Sandes mista', en:'Ham and cheese sandwich'},
      {id:'c61', pt:'Sandes de queijo', en:'Cheese sandwich'},
      {id:'c62', pt:'Past√©is de nata', en:'Custard tarts'},
      {id:'c63', pt:'Gelado de‚Ä¶', en:'Ice cream of‚Ä¶'},
      {id:'c64', pt:'Mousse de‚Ä¶', en:'Mousse of‚Ä¶'},
      {id:'c65', pt:'P√£o', en:'Bread'},
      {id:'c66', pt:'Queijo fresco', en:'Fresh cheese'},
      {id:'c67', pt:'Manteiga', en:'Butter'},
      {id:'c68', pt:'Lulas', en:'Squid'},
      {id:'c69', pt:'Azeitonas verdes/pretas', en:'Green/black olives'},
      {id:'c70', pt:'Sopa de‚Ä¶', en:'Soup of‚Ä¶'},
      {id:'c71', pt:'Salada de‚Ä¶', en:'Salad of‚Ä¶'},
      {id:'c72', pt:'Alcatra', en:'Azorean beef stew'},
      {id:'c73', pt:'Bitoque', en:'Steak with egg and fries'},
      {id:'c74', pt:'Polvo grelhado', en:'Grilled octopus'},
      {id:'c75', pt:'Polvo √† Mo√ßambique', en:'Mozambique-style octopus'},
      {id:'c76', pt:'Porco √† Alentejana', en:'Alentejo-style pork with clams'},
      {id:'c77', pt:'Camar√£o Mo√ßambique', en:'Mozambique-style shrimp'},
      {id:'c78', pt:'Paella', en:'Paella'},
      {id:'c79', pt:'Bacalhau √† Br√°s', en:'Br√°s-style cod'},
      {id:'c80', pt:'Frutas', en:'Fruit'},
      {id:'c81', pt:'Carne', en:'Meat'},
      {id:'c82', pt:'Peixe', en:'Fish'},
      {id:'c83', pt:'Massa', en:'Pasta'},
      {id:'c84', pt:'Vegetais', en:'Vegetables'},
      {id:'c85', pt:'Frango', en:'Chicken'},
      {id:'c86', pt:'Salada', en:'Salad'},
      {id:'c87', pt:'Batatas fritas', en:'French fries'}
    ]
  },
  {
    title:'Vocabul√°rio de Bebidas (Drinks Vocabulary)',
    phrases:[
      {id:'c88', pt:'Superbock', en:'Superbock (beer)'},
      {id:'c89', pt:'Sagres', en:'Sagres (beer)'},
      {id:'c90', pt:'Ch√° de lim√£o', en:'Lemon tea'},
      {id:'c91', pt:'Bica / caf√©', en:'Espresso'},
      {id:'c92', pt:'√Ågua', en:'Water'},
      {id:'c93', pt:'√Ågua de lim√£o / √°gua com lim√£o', en:'Lemon water / water with lemon'},
      {id:'c94', pt:'Sumo de‚Ä¶', en:'Juice of‚Ä¶'},
      {id:'c95', pt:'Refrigerantes', en:'Soft drinks'},
      {id:'c96', pt:'Cerveja', en:'Beer'},
      {id:'c97', pt:'Vodka', en:'Vodka'},
      {id:'c98', pt:'Rum', en:'Rum'},
      {id:'c99', pt:'Esp√≠ritos', en:'Spirits'},
      {id:'c100', pt:'Vinho tinto / branco / verde / ros√©', en:'Red / white / green / ros√© wine'},
      {id:'c101', pt:'Sidra', en:'Cider'},
      {id:'c102', pt:'Copo de‚Ä¶', en:'Glass of‚Ä¶'}
    ]
  },
  {
    title:'Utens√≠lios e Objetos do Restaurante (Utensils & Restaurant Objects)',
    phrases:[
      {id:'c103', pt:'Garfo', en:'Fork'},
      {id:'c104', pt:'Faca', en:'Knife'},
      {id:'c105', pt:'Colher', en:'Spoon'},
      {id:'c106', pt:'Colher de sopa', en:'Tablespoon'},
      {id:'c107', pt:'Colher de ch√°', en:'Teaspoon'},
      {id:'c108', pt:'Prato', en:'Plate'},
      {id:'c109', pt:'Copo', en:'Glass'},
      {id:'c110', pt:'Ta√ßa', en:'Bowl / cup'},
      {id:'c111', pt:'Guardanapo', en:'Napkin'},
      {id:'c112', pt:'Palito', en:'Toothpick'},
      {id:'c113', pt:'Prato fundo', en:'Soup plate'},
      {id:'c114', pt:'Travessa', en:'Serving dish'},
      {id:'c115', pt:'Jarra', en:'Pitcher / jug'}
    ]
  },
  {
    title:'Perguntar Detalhes Sobre o Menu (Asking About the Menu)',
    phrases:[
      {id:'c116', pt:'Do que √© feito?', en:'What is it made of?'},
      {id:'c117', pt:'Tem alergias?', en:'Do you have allergies?'},
      {id:'c118', pt:'√â picante?', en:'Is it spicy?'},
      {id:'c119', pt:'√â vegetariano?', en:'Is it vegetarian?'},
      {id:'c120', pt:'√â vegan?', en:'Is it vegan?'},
      {id:'c121', pt:'Pode vir sem‚Ä¶?', en:'Can it be made without‚Ä¶?'},
      {id:'c122', pt:'O prato √© grande?', en:'Is the dish large?'},
      {id:'c123', pt:'Posso trocar o acompanhamento?', en:'Can I change the side dish?'}
    ]
  },
  {
    title:'Depois da Refei√ß√£o e Pagar a Conta (After the Meal & Paying the Bill)',
    phrases:[
      {id:'c124', pt:'A comida estava boa?', en:'Was the food good?'},
      {id:'c125', pt:'N√≥s gost√°mos.', en:'We liked it.'},
      {id:'c126', pt:'A conta, por favor.', en:'The bill, please.'},
      {id:'c127', pt:'Gostaria da conta, por favor.', en:'I would like the bill, please.'},
      {id:'c128', pt:'Queria pagar com dinheiro.', en:'I would like to pay with cash.'},
      {id:'c129', pt:'Queria pagar com cart√£o.', en:'I would like to pay with card.'},
      {id:'c130', pt:'Quer pagar j√°?', en:'Do you want to pay now?'},
      {id:'c131', pt:'Aqui est√°.', en:'Here it is.'},
      {id:'c132', pt:'Troco', en:'Change (money)'},
      {id:'c133', pt:'C√™ntimos', en:'Cents'},
      {id:'c134', pt:'Euros', en:'Euros'},
      {id:'c135', pt:'Quer o recibo?', en:'Do you want the receipt?'},
      {id:'c136', pt:'Pode ficar com o troco.', en:'You can keep the change.'},
      {id:'c137', pt:'Estava tudo √≥timo, obrigado/obrigada.', en:'Everything was great, thank you.'},
      {id:'c138', pt:'Obrigado, at√© √† pr√≥xima.', en:'Thank you, see you next time.'},
      {id:'c139', pt:'Estou a aprender portugu√™s, quero praticar o meu portugu√™s.', en:'I am learning Portuguese, I want to practise my Portuguese.'}
    ]
  }
];

const container = document.getElementById('phrasebook');

// ----------------------------------------------------
// RENDER SECTIONS
// ----------------------------------------------------
sections.forEach(section=>{
  const secDiv=document.createElement('div');
  const h2=document.createElement('h2');
  const titleSpan=document.createElement('span');
  titleSpan.textContent=section.title;
  h2.appendChild(titleSpan);

  const controls=document.createElement('div');
  controls.className='section-controls';

  const repeatBtn=document.createElement('button');
  repeatBtn.className='repeat';
  repeatBtn.textContent='Listen & Repeat Section';
  repeatBtn.addEventListener('click',()=>repeatSection(section));
  controls.appendChild(repeatBtn);

  const downloadBtn=document.createElement('button');
  downloadBtn.className='download';
  downloadBtn.textContent='Download Section Audio';
  downloadBtn.addEventListener('click',()=>downloadSection(section,h2));
  controls.appendChild(downloadBtn);

  h2.appendChild(controls);
  secDiv.appendChild(h2);

  const progressMsg=document.createElement('div');
  progressMsg.className='progress-message';
  secDiv.appendChild(progressMsg);

  const table=document.createElement('table');
  const thead=document.createElement('thead');
  thead.innerHTML='<tr><th>Portugu√™s</th><th>English</th><th>Actions</th></tr>';
  table.appendChild(thead);

  const tbody=document.createElement('tbody');

  section.phrases.forEach(ph=>{
    const tr=document.createElement('tr');

    const tdPt=document.createElement('td');
    tdPt.className='pt';
    tdPt.textContent=ph.pt;

    const tdEn=document.createElement('td');
    tdEn.className='en';
    tdEn.textContent=ph.en;

    const tdActions=document.createElement('td');
    tdActions.className='actions';

    const playBtn=document.createElement('button');
    playBtn.className='play';
    playBtn.textContent='Play';
    playBtn.addEventListener('click',()=>playAudio(ph.id,1));
    tdActions.appendChild(playBtn);

    const slowBtn=document.createElement('button');
    slowBtn.className='slow';
    slowBtn.textContent='Slow';
    slowBtn.addEventListener('click',()=>playAudio(ph.id,0.8));
    tdActions.appendChild(slowBtn);

    tr.appendChild(tdPt);
    tr.appendChild(tdEn);
    tr.appendChild(tdActions);
    tbody.appendChild(tr);
  });

  table.appendChild(tbody);
  secDiv.appendChild(table);
  container.appendChild(secDiv);
});

// ----------------------------------------------------
// AUDIO HELPERS
// ----------------------------------------------------
let currentAudioObj=null;

function playAudio(id,rate=1){
  if(currentAudioObj){
    currentAudioObj.pause();
    currentAudioObj=null;
  }
  const audio=new Audio('audio/'+id+'.mp3');
  audio.playbackRate=rate;
  audio.play();
  currentAudioObj=audio;
}

function repeatSection(section){
  let i=0;
  const playNext=()=>{
    if(i<section.phrases.length){
      playAudio(section.phrases[i].id,1);
      i++;
      setTimeout(playNext,3000);
    }
  };
  playNext();
}

// ----------------------------------------------------
// SHARED HELPERS
// ----------------------------------------------------
function shuffle(arr){
  return arr.sort(()=>Math.random()-0.5);
}

function generateOptions(correct,pool){
  const set=new Set([correct]);
  while(set.size<4 && pool.length>0){
    const c=pool[Math.floor(Math.random()*pool.length)];
    set.add(c);
  }
  return shuffle(Array.from(set));
}

function sanitizeFilename(s){
  return s
    .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
    .replace(/[^\w\s-]/g,'')
    .trim()
    .replace(/\s+/g,'_');
}

// ----------------------------------------------------
// GLOBAL QUIZ (TEXT + AUDIO MODES)
// ----------------------------------------------------
const unifiedBtn = document.getElementById('startQuizUnified');
const unifiedStep = document.getElementById('quizUnifiedStep');
const globalQuizBox = document.getElementById('globalQuizBox');

let activeQuiz=null;

unifiedBtn.addEventListener('click',()=>{
  closeActiveQuiz();
  globalQuizBox.style.display='none';
  unifiedStep.innerHTML='';
  showModeChooser(mode=>{
    const phrases = sections.flatMap(s=>s.phrases);
    if(mode === 'audio'){
      startAudioQuiz({
        phrases,
        container:globalQuizBox,
        onBeforeStart:()=>{
          closeActiveQuiz();
          globalQuizBox.innerHTML='';
          globalQuizBox.style.display='block';
        }
      });
    }else{
      startTextQuiz({
        mode,
        phrases,
        container:globalQuizBox,
        onBeforeStart:()=>{
          closeActiveQuiz();
          globalQuizBox.innerHTML='';
          globalQuizBox.style.display='block';
        }
      });
    }
  });
});

// Choose quiz mode
function showModeChooser(onChoose){
  const modeWrap=document.createElement('div');
  modeWrap.className='mode-chooser';
  modeWrap.innerHTML=`
    <button class="quiz" data-mode="pt-en">üáµüáπ Portuguese ‚Üí English</button>
    <button class="quiz" data-mode="en-pt">üá¨üáß English ‚Üí Portuguese</button>
    <button class="quiz" data-mode="mix">üîÑ Mixed</button>
    <button class="quiz" data-mode="audio">üîä Audio Quiz (PT ‚Üí EN)</button>
  `;
  unifiedStep.innerHTML='';
  unifiedStep.appendChild(modeWrap);
  modeWrap.querySelectorAll('button').forEach(b=>{
    b.addEventListener('click',()=>{
      const mode=b.dataset.mode;
      unifiedStep.innerHTML='';
      onChoose(mode);
    });
  });
}

// TEXT QUIZ
function startTextQuiz({mode,phrases,container,onBeforeStart}){
  if(onBeforeStart) onBeforeStart();

  const state={
    idx:0,
    score:0,
    list:shuffle(phrases.slice()),
    stop(){
      container.style.display='none';
      container.innerHTML='';
    }
  };
  closeActiveQuiz();
  activeQuiz=state;

  const qEl=document.createElement('div');
  qEl.className='quiz-question';

  const optsEl=document.createElement('div');
  optsEl.className='quiz-options';

  const ctrEl=document.createElement('div');
  ctrEl.className='muted';
  ctrEl.style.marginTop='10px';

  const nextWrap=document.createElement('div');
  nextWrap.style.marginTop='10px';

  const nextBtn=document.createElement('button');
  nextBtn.className='quiz';
  nextBtn.textContent='Next';
  nextBtn.style.display='none';

  nextWrap.appendChild(nextBtn);
  container.appendChild(qEl);
  container.appendChild(optsEl);
  container.appendChild(ctrEl);
  container.appendChild(nextWrap);

  function renderQuestion(){
    if(state.idx>=state.list.length){
      qEl.textContent=`‚úÖ Quiz complete! You scored ${state.score} / ${state.list.length}.`;
      optsEl.innerHTML='';
      nextBtn.textContent='Close';
      nextBtn.style.display='inline-block';
      nextBtn.onclick=()=>{ closeActiveQuiz(); };
      return;
    }

    const item=state.list[state.idx];
    let dir = mode === 'mix'
      ? (Math.random()>0.5?'pt-en':'en-pt')
      : mode;

    const isPtEn = dir==='pt-en';
    const questionText = isPtEn ? item.pt : item.en;
    const correct = isPtEn ? item.en : item.pt;
    const pool = isPtEn
      ? state.list.map(p=>p.en)
      : state.list.map(p=>p.pt);

    const options=generateOptions(correct,pool);

    qEl.textContent = questionText;
    optsEl.innerHTML='';
    ctrEl.textContent=`Question ${state.idx+1} of ${state.list.length}`;

    options.forEach(opt=>{
      const b=document.createElement('button');
      b.textContent=opt;
      b.addEventListener('click',()=>{
        Array.from(optsEl.children).forEach(btn=>btn.disabled=true);
        if(opt===correct){
          b.classList.add('correct');
          state.score++;
        }else{
          b.classList.add('wrong');
          Array.from(optsEl.children).forEach(btn=>{
            if(btn.textContent===correct) btn.classList.add('correct');
          });
        }
        nextBtn.style.display='inline-block';
        nextBtn.onclick=()=>{
          nextBtn.style.display='none';
          state.idx++;
          renderQuestion();
        };
      });
      optsEl.appendChild(b);
    });
  }

  renderQuestion();
}

// AUDIO QUIZ (PT audio ‚Üí EN options)
function startAudioQuiz({phrases,container,onBeforeStart}){
  if(onBeforeStart) onBeforeStart();

  const state={
    idx:0,
    score:0,
    list:shuffle(phrases.slice()),
    stop(){
      container.style.display='none';
      container.innerHTML='';
    }
  };
  closeActiveQuiz();
  activeQuiz=state;

  const qEl=document.createElement('div');
  qEl.className='quiz-question';
  qEl.textContent='Listen and choose the correct translation:';

  const audioBtn=document.createElement('button');
  audioBtn.className='quiz';
  audioBtn.textContent='‚ñ∂Ô∏è Play';
  audioBtn.style.marginBottom='12px';

  const optsEl=document.createElement('div');
  optsEl.className='quiz-options';

  const ctrEl=document.createElement('div');
  ctrEl.className='muted';
  ctrEl.style.marginTop='10px';

  const nextWrap=document.createElement('div');
  nextWrap.style.marginTop='12px';

  const nextBtn=document.createElement('button');
  nextBtn.className='quiz';
  nextBtn.textContent='Next';
  nextBtn.style.display='none';

  nextWrap.appendChild(nextBtn);

  container.appendChild(qEl);
  container.appendChild(audioBtn);
  container.appendChild(optsEl);
  container.appendChild(ctrEl);
  container.appendChild(nextWrap);

  function playAudioFor(item){
    playAudio(item.id,1);
  }

  function renderAudioQuestion(){
    if(state.idx>=state.list.length){
      qEl.textContent=`‚úÖ Audio Quiz complete! You scored ${state.score} / ${state.list.length}.`;
      audioBtn.style.display='none';
      optsEl.innerHTML='';
      nextBtn.textContent='Close';
      nextBtn.style.display='inline-block';
      nextBtn.onclick=()=>{ closeActiveQuiz(); };
      ctrEl.textContent='';
      return;
    }

    const item=state.list[state.idx];
    const correct=item.en;
    const pool=state.list.map(p=>p.en);
    const options=generateOptions(correct,pool);

    // Reset UI
    audioBtn.textContent='‚ñ∂Ô∏è Play';
    optsEl.innerHTML='';
    nextBtn.style.display='none';
    ctrEl.textContent=`Question ${state.idx+1} of ${state.list.length}`;

    // Play/Replay logic
    audioBtn.onclick=()=>{
      audioBtn.textContent='üîÅ Play again';
      playAudioFor(item);
    };

    options.forEach(opt=>{
      const b=document.createElement('button');
      b.textContent=opt;
      b.addEventListener('click',()=>{
        Array.from(optsEl.children).forEach(btn=>btn.disabled=true);

        if(opt===correct){
          b.classList.add('correct');
          state.score++;
        }else{
          b.classList.add('wrong');
          Array.from(optsEl.children).forEach(btn=>{
            if(btn.textContent===correct) btn.classList.add('correct');
          });
        }

        nextBtn.style.display='inline-block';
        nextBtn.onclick=()=>{
          state.idx++;
          renderAudioQuestion();
        };
      });
      optsEl.appendChild(b);
    });
  }

  renderAudioQuestion();
}

// Close any active quiz
function closeActiveQuiz(){
  if(activeQuiz && typeof activeQuiz.stop==='function'){
    activeQuiz.stop();
  }
  activeQuiz=null;
}

// ----------------------------------------------------
// ZIP DOWNLOAD PER SECTION
// ----------------------------------------------------
async function downloadSection(section,header){
  const zip=new JSZip();
  const msg=header.nextElementSibling;
  const btn=header.querySelector('.download');

  msg.textContent='Preparing ZIP...';
  btn.disabled=true;

  const total=section.phrases.length;
  let done=0;

  for(const ph of section.phrases){
    const fname=sanitizeFilename(ph.pt)+'.mp3';
    const url='audio/'+ph.id+'.mp3';
    try{
      const r=await fetch(url);
      if(!r.ok) throw new Error();
      const blob=await r.blob();
      zip.file(fname,blob);
      done++;
      msg.textContent=`Preparing ZIP... ${Math.round(done/total*100)}%`;
    }catch{
      msg.textContent=`‚ö†Ô∏è Missing file: ${ph.id}.mp3`;
    }
  }

  const content=await zip.generateAsync({type:'blob'},m=>{
    msg.textContent=`Compressing... ${Math.round(m.percent)}%`;
  });

  saveAs(content, section.title.replace(/\s+/g,'_')+'.zip');

  msg.textContent='‚úÖ Download ready!';
  btn.classList.add('done');
  btn.disabled=false;

  setTimeout(()=>{
    msg.textContent='';
    btn.classList.remove('done');
  },4000);
}

// ----------------------------------------------------
// FLASHCARDS WITH IMAGES
// ----------------------------------------------------
const flashcardBox=document.getElementById('flashcardBox');
const startFlashcardsBtn=document.getElementById('startFlashcards');
const prevFlashcardBtn=document.getElementById('prevFlashcard');
const nextFlashcardBtn=document.getElementById('nextFlashcard');
const shuffleFlashcardsBtn=document.getElementById('shuffleFlashcards');

const allPhrases = sections.flatMap(s=>s.phrases);

let flashcardOrder = [];
let flashcardIndex = 0;
let flashcardShowPT = true;

function initFlashcards(){
  flashcardOrder = shuffle(allPhrases.slice());
  flashcardIndex = 0;
  flashcardShowPT = true;
  renderFlashcard();
}

function renderFlashcard(){
  if(!flashcardOrder.length){
    flashcardBox.style.display='none';
    return;
  }
  const item = flashcardOrder[flashcardIndex];
  flashcardBox.style.display='block';
  flashcardBox.innerHTML='';

  const img=document.createElement('img');
  // Image path pattern: put your images in /img with filenames matching the ID, e.g. img/c57.webp
  img.src='img/'+item.id+'.webp';
  img.alt=item.pt;

  const ptDiv=document.createElement('div');
  ptDiv.className='flashcard-pt';
  const enDiv=document.createElement('div');
  enDiv.className='flashcard-en';

  if(flashcardShowPT){
    ptDiv.textContent=item.pt;
    enDiv.textContent='';
  }else{
    ptDiv.textContent=item.en;
    enDiv.textContent='';
  }

  const indexDiv=document.createElement('div');
  indexDiv.className='flashcard-index';
  indexDiv.textContent=`${flashcardIndex+1} / ${flashcardOrder.length}`;

  const audioDiv=document.createElement('div');
  audioDiv.className='flashcard-audio';
  const playBtn=document.createElement('button');
  playBtn.className='play';
  playBtn.textContent='Play';
  playBtn.addEventListener('click',e=>{
    e.stopPropagation();
    playAudio(item.id,1);
  });
  const slowBtn=document.createElement('button');
  slowBtn.className='slow';
  slowBtn.textContent='Slow';
  slowBtn.addEventListener('click',e=>{
    e.stopPropagation();
    playAudio(item.id,0.8);
  });
  audioDiv.appendChild(playBtn);
  audioDiv.appendChild(slowBtn);

  flashcardBox.appendChild(img);
  flashcardBox.appendChild(ptDiv);
  flashcardBox.appendChild(enDiv);
  flashcardBox.appendChild(audioDiv);
  flashcardBox.appendChild(indexDiv);
}

// Toggle between PT and EN on click
flashcardBox.addEventListener('click',()=>{
  flashcardShowPT = !flashcardShowPT;
  renderFlashcard();
});

startFlashcardsBtn.addEventListener('click',()=>{
  initFlashcards();
});

nextFlashcardBtn.addEventListener('click',()=>{
  if(!flashcardOrder.length) return;
  flashcardIndex = (flashcardIndex+1) % flashcardOrder.length;
  flashcardShowPT = true;
  renderFlashcard();
});

prevFlashcardBtn.addEventListener('click',()=>{
  if(!flashcardOrder.length) return;
  flashcardIndex = (flashcardIndex-1+flashcardOrder.length) % flashcardOrder.length;
  flashcardShowPT = true;
  renderFlashcard();
});

shuffleFlashcardsBtn.addEventListener('click',()=>{
  if(!allPhrases.length) return;
  flashcardOrder = shuffle(allPhrases.slice());
  flashcardIndex = 0;
  flashcardShowPT = true;
  renderFlashcard();
});
</script>
</body>
</html>
